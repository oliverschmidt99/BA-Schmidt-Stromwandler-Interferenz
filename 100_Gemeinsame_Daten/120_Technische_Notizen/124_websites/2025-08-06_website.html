<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktive Analyse: Stromwandler-Genauigkeit nach R.A. Pfuntner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: Die Anwendung ist in f√ºnf logische, thematische Abschnitte gegliedert, um den Benutzer von der Problemstellung zur L√∂sung und Anwendung zu f√ºhren. 1. Einf√ºhrung: Erkl√§rt das "Warum" - die Gefahr von Fremdfeldern. 2. Interaktiver Rechner: Das Herzst√ºck, das es dem Benutzer erm√∂glicht, Pfuntners vereinfachte Methode zur S√§ttigungsberechnung selbst anzuwenden und die Auswirkungen von Parametern zu "f√ºhlen". 3. Experimentelle Daten: Visualisiert die originalen Messergebnisse aus dem Paper interaktiv, um die Theorie zu validieren. 4. Die Kernformel: Detaillierte Aufschl√ºsselung der zentralen Gleichung f√ºr ein tieferes Verst√§ndnis. 5. Fazit & Verm√§chtnis: Fasst die wichtigsten Erkenntnisse zusammen. Diese Struktur priorisiert das didaktische Erlebnis und die praktische Anwendbarkeit gegen√ºber der linearen Struktur des Original-Papers. -->
    <!-- Visualization & Content Choices: Report Info -> Fremdfeldeinfluss auf CT-Genauigkeit. Goal -> Verstehen, Berechnen, Vergleichen. Viz/Presentation -> Interaktiver Rechner mit Schiebereglern und visueller R√ºckmeldung (HTML/CSS-Diagramm), dynamisches Liniendiagramm (Chart.js) zur Darstellung der Original-Messkurven, aufklappbare Textabschnitte f√ºr Erkl√§rungen. Interaction -> Benutzer w√§hlt Testwandler, passt Abstand/B√ºrde an und sieht sofortige Neuberechnung von Fl√ºssen und S√§ttigungsgrenze. Im Chart kann zwischen den Testszenarien umgeschaltet werden. Justification -> Diese interaktiven Elemente machen die komplexen Zusammenh√§nge greifbar und f√∂rdern ein tieferes Verst√§ndnis als statischer Text. Library/Method -> Vanilla JS f√ºr die Logik, Chart.js f√ºr die Visualisierung der Daten. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #333;
        }

        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
            border-bottom: 2px solid transparent;
        }

        .nav-link.active,
        .nav-link:hover {
            color: #005A9C;
            border-bottom-color: #005A9C;
        }

        .card {
            background-color: #FFFFFF;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }

        .btn {
            transition: background-color 0.3s, transform 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-primary {
            background-color: #007ACC;
            color: white;
        }

        .btn-primary:hover {
            background-color: #005A9C;
        }

        .btn-secondary {
            background-color: #E0E0E0;
            color: #333;
        }

        .btn-secondary.active {
            background-color: #007ACC;
            color: white;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
            font-weight: 400;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .flux-ring {
            position: relative;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
        }

        .flux-ring-inner {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 15px solid;
            transition: border-color 0.5s;
        }
    </style>
</head>

<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-40 w-full border-b border-gray-200">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <h1 class="text-xl md:text-2xl font-bold text-gray-800">Analyse der Stromwandler-Genauigkeit</h1>
                <nav class="hidden md:flex space-x-6">
                    <a href="#problem" class="nav-link active">Problem</a>
                    <a href="#rechner" class="nav-link">Rechner</a>
                    <a href="#daten" class="nav-link">Experimente</a>
                    <a href="#formel" class="nav-link">Formel</a>
                    <a href="#fazit" class="nav-link">Fazit</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 md:py-12">

        <!-- Section 1: Das Problem -->
        <section id="problem" class="scroll-mt-20 mb-16">
            <h2 class="text-3xl font-bold text-center mb-4">Das Problem: Unsichtbare St√∂rfelder</h2>
            <p class="text-lg text-center text-gray-600 max-w-3xl mx-auto mb-8">
                In Schaltanlagen flie√üen gewaltige Str√∂me. Benachbarte Leiter erzeugen starke magnetische Fremdfelder,
                die die Genauigkeit von Stromwandlern massiv beeintr√§chtigen k√∂nnen. Diese Analyse basiert auf der
                bahnbrechenden Arbeit von R.A. Pfuntner aus dem Jahr 1951, die dieses Problem erstmals quantifizierbar
                machte.
            </p>
            <div class="card p-6 md:p-8">
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h3 class="text-2xl font-bold mb-4 text-red-600">Der Effekt: Vorzeitige S√§ttigung</h3>
                        <p class="mb-4">Ein Fremdfeld √ºberlagert den normalen Messfluss im Wandlerkern. Auf der dem
                            St√∂rleiter zugewandten Seite addieren sich die Fl√ºsse, was zu einer lokalen, verfr√ºhten
                            S√§ttigung des Kernmaterials f√ºhrt.</p>
                        <p class="font-semibold mb-2">Die Konsequenz:</p>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>Der Wandler kann den Prim√§rstrom nicht mehr korrekt abbilden.</li>
                            <li>Der √úbersetzungsfehler explodiert.</li>
                            <li>Das Schutzrelais empf√§ngt ein falsches Signal und l√∂st im Fehlerfall m√∂glicherweise
                                nicht aus.</li>
                        </ul>
                        <p class="mt-4 p-4 bg-yellow-100 border-l-4 border-yellow-500 rounded-r-lg">
                            <span class="font-bold">Pfuntners Beispiel:</span> Ein Wandler, der bei 30 cm Abstand erst
                            bei 10.000 A s√§ttigt, erreicht diesen kritischen Punkt bei nur 15 cm Abstand bereits bei
                            6.000 A.
                        </p>
                    </div>
                    <div class="text-center">
                        <div class="relative inline-block">
                            <div class="absolute top-1/2 -translate-y-1/2 -left-20 text-5xl"
                                title="Prim√§rleiter im Wandler">‚ö°Ô∏è</div>
                            <div
                                class="w-48 h-48 rounded-full bg-gray-200 border-8 border-gray-400 flex items-center justify-center font-bold text-gray-600">
                                CT Kern
                            </div>
                            <div class="absolute top-1/2 -translate-y-1/2 -right-24 text-5xl text-red-500"
                                title="St√∂rleiter (R√ºckleiter)">‚ö°Ô∏è</div>
                            <div
                                class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-8 text-red-500 font-semibold">
                                Streufluss üß≤
                            </div>
                            <div
                                class="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-8 text-blue-500 font-semibold">
                                B√ºrdenfluss üß≤
                            </div>
                        </div>
                        <p class="mt-4 text-sm text-gray-500">Schematische Darstellung der Fluss√ºberlagerung</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Der Rechner -->
        <section id="rechner" class="scroll-mt-20 mb-16">
            <h2 class="text-3xl font-bold text-center mb-4">Interaktiver S√§ttigungs-Rechner</h2>
            <p class="text-lg text-center text-gray-600 max-w-3xl mx-auto mb-8">
                Wenden Sie Pfuntners vereinfachte Methode selbst an. W√§hlen Sie einen Testwandler oder geben Sie eigene
                Daten ein und beobachten Sie, wie sich die Parameter auf die S√§ttigung auswirken.
            </p>
            <div class="card p-6 md:p-8">
                <div class="grid lg:grid-cols-3 gap-8">
                    <!-- Input Column -->
                    <div class="lg:col-span-2">
                        <h3 class="text-2xl font-bold mb-6">Parameter einstellen</h3>

                        <div class="mb-6">
                            <label class="font-semibold block mb-2">1. Wandler-Modell w√§hlen</label>
                            <div class="flex flex-wrap gap-2">
                                <button id="btn-ct1" type="button"
                                    class="btn btn-secondary px-4 py-2 rounded-lg">Testwandler 1</button>
                                <button id="btn-ct2" type="button"
                                    class="btn btn-secondary px-4 py-2 rounded-lg">Testwandler 2</button>
                                <button id="btn-ct3" type="button"
                                    class="btn btn-secondary px-4 py-2 rounded-lg">Testwandler 3</button>
                                <button id="btn-custom" type="button"
                                    class="btn btn-secondary px-4 py-2 rounded-lg">Benutzerdefiniert</button>
                            </div>
                        </div>

                        <div id="custom-inputs" class="grid md:grid-cols-2 gap-4 mb-6 hidden">
                            <div>
                                <label for="R" class="block text-sm font-medium text-gray-700">Mittlerer Radius R
                                    (Zoll)</label>
                                <input type="number" id="R" value="3"
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="r_inner" class="block text-sm font-medium text-gray-700">Innenradius r
                                    (Zoll)</label>
                                <input type="number" id="r_inner" value="1.5"
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="W" class="block text-sm font-medium text-gray-700">Kernbreite W
                                    (Zoll)</label>
                                <input type="number" id="W" value="0.5"
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="A" class="block text-sm font-medium text-gray-700">Kernquerschnitt A
                                    (Zoll¬≤)</label>
                                <input type="number" id="A" value="0.71"
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            </div>
                        </div>

                        <div class="mb-6">
                            <label for="D_slider" class="font-semibold block mb-2">2. Abstand zum St√∂rleiter D: <span
                                    id="D_val">12</span> Zoll</label>
                            <input type="range" id="D_slider" min="3.5" max="30" value="12" step="0.5"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            <div>
                                <label for="Zb" class="font-semibold block mb-2">3. Sekund√§rb√ºrde Z<sub>B</sub>
                                    (Ohm)</label>
                                <input type="number" id="Zb" value="0.305" step="0.01"
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="Ns" class="font-semibold block mb-2">Sekund√§rwindungen N<sub>s</sub></label>
                                <input type="number" id="Ns" value="183"
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            </div>
                        </div>
                    </div>

                    <!-- Output Column -->
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h3 class="text-2xl font-bold mb-4">Ergebnisse</h3>
                        <div class="text-center mb-4">
                            <div id="flux-ring" class="flux-ring">
                                <div id="flux-ring-inner" class="flux-ring-inner"></div>
                                <span class="font-bold text-lg z-10">Kern</span>
                            </div>
                            <p class="text-sm text-gray-600">Visuelle Flussdichte</p>
                        </div>
                        <div id="status-box"
                            class="p-4 rounded-lg text-center font-bold text-xl mb-4 transition-colors">
                            STATUS
                        </div>
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between"><span>Aufnahmefaktor k:</span><span id="k_val"
                                    class="font-mono font-semibold"></span></div>
                            <div class="flex justify-between"><span>Max. sicherer Strom I<sub>p</sub>:</span><span
                                    id="Ip_limit" class="font-mono font-semibold"></span></div>
                            <hr>
                            <p class="text-xs text-gray-500 text-center">Berechnungen basieren auf der vereinfachten
                                Methode f√ºr 50 Hz.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Die Daten -->
        <section id="daten" class="scroll-mt-20 mb-16">
            <h2 class="text-3xl font-bold text-center mb-4">Pfuntners Experimente erkunden</h2>
            <p class="text-lg text-center text-gray-600 max-w-3xl mx-auto mb-8">
                Visualisieren Sie die originalen Messergebnisse aus Pfuntners Paper. W√§hlen Sie einen Wandler und eine
                Konfiguration, um die Genauigkeitskurven (√úbersetzungsfehler und Phasenwinkel) anzuzeigen.
            </p>
            <div class="card p-6 md:p-8">
                <div class="flex flex-wrap justify-center gap-4 mb-6">
                    <div>
                        <label for="chart-ct" class="text-sm font-medium">Wandler:</label>
                        <select id="chart-ct" class="rounded-md border-gray-300 shadow-sm">
                            <option value="1">Testwandler 1</option>
                            <option value="2">Testwandler 2</option>
                            <option value="3">Testwandler 3</option>
                        </select>
                    </div>
                    <div>
                        <label for="chart-burden" class="text-sm font-medium">B√ºrde (Ohm):</label>
                        <select id="chart-burden" class="rounded-md border-gray-300 shadow-sm">
                            <option value="low">Niedrig</option>
                            <option value="high">Hoch</option>
                        </select>
                    </div>
                    <div>
                        <label for="chart-distance" class="text-sm font-medium">Abstand (Zoll):</label>
                        <select id="chart-distance" class="rounded-md border-gray-300 shadow-sm">
                            <option value="6">6"</option>
                            <option value="12">12"</option>
                            <option value="24">24"</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="accuracyChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Section 4: Die Formel -->
        <section id="formel" class="scroll-mt-20 mb-16">
            <h2 class="text-3xl font-bold text-center mb-4">Die Kernformel im Detail</h2>
            <p class="text-lg text-center text-gray-600 max-w-3xl mx-auto mb-8">
                Dies ist die zentrale Gleichung (14) aus Pfuntners Arbeit zur Berechnung des gesamten eingekoppelten
                Streuflusses.
            </p>
            <div class="card p-6 md:p-8">
                <div class="bg-gray-100 p-4 rounded-lg text-center mb-6">
                    <p class="text-lg md:text-xl font-mono">
                        &Phi;<sub>0</sub> = C &sdot; k &sdot; W &sdot; I<sub>0</sub> &sdot; ln( (D+R) / (D-R) )
                    </p>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <strong class="font-mono text-blue-600">&Phi;<sub>0</sub></strong>
                        <p class="text-sm">Gesamter Streufluss, der in den Kern eintritt.</p>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <strong class="font-mono text-blue-600">C</strong>
                        <p class="text-sm">Konstante, angepasst f√ºr 50 Hz (~1.60 x 10<sup>-6</sup>). Original (60 Hz)
                            war 1.92 x 10<sup>-6</sup>.</p>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg tooltip">
                        <strong class="font-mono text-blue-600">k</strong>
                        <p class="text-sm">Der empirische Aufnahmefaktor (dimensionslos).</p>
                        <span class="tooltiptext">Wird aus den geometrischen Verh√§ltnissen des Kerns ermittelt (siehe
                            Abb. 6 im Paper).</span>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <strong class="font-mono text-blue-600">W</strong>
                        <p class="text-sm">Die axiale Breite (H√∂he) des Kerns in Zoll.</p>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <strong class="font-mono text-blue-600">I<sub>0</sub></strong>
                        <p class="text-sm">Der Strom im st√∂renden Fremdleiter in Ampere.</p>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <strong class="font-mono text-blue-600">D</strong>
                        <p class="text-sm">Mittenabstand zwischen Wandler- und Fremdleiter in Zoll.</p>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <strong class="font-mono text-blue-600">R</strong>
                        <p class="text-sm">Mittlerer Radius des Wandlerkerns in Zoll.</p>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <strong class="font-mono text-blue-600">ln</strong>
                        <p class="text-sm">Nat√ºrlicher Logarithmus.</p>
                    </div>
                </div>
                <div class="mt-6 p-4 bg-green-100 border-l-4 border-green-500 rounded-r-lg">
                    <h4 class="font-bold">Formel-Check: schutztechnik.com</h4>
                    <p class="text-sm">Die auf der Webseite verwendete Formel ist eine korrekte Anwendung von Pfuntners
                        Methode. Die Anpassung der Konstante auf 50 Hz ist fachgerecht und notwendig f√ºr den
                        europ√§ischen Raum. Die Formel ist somit **valide und korrekt**.</p>
                </div>
            </div>
        </section>

        <!-- Section 5: Fazit -->
        <section id="fazit" class="scroll-mt-20">
            <h2 class="text-3xl font-bold text-center mb-4">Fazit und Verm√§chtnis</h2>
            <p class="text-lg text-center text-gray-600 max-w-3xl mx-auto mb-8">
                Pfuntners √ºber 70 Jahre alte Arbeit ist heute relevanter denn je. Sie liefert nicht nur Formeln, sondern
                ein tiefes physikalisches Verst√§ndnis f√ºr ein kritisches Problem der Schutztechnik.
            </p>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="card p-6">
                    <h3 class="text-xl font-bold mb-3">Wissenschaft trifft Praxis</h3>
                    <p class="text-gray-700">Die Diskussion mit Westinghouse im Paper zeigt eindrucksvoll, wie Pfuntners
                        wissenschaftliche Analyse etablierte "Faustregeln" der Industrie untermauerte, ihre Grenzen
                        aufzeigte und so den Weg f√ºr zuverl√§ssigere Schutzsysteme ebnete.</p>
                </div>
                <div class="card p-6">
                    <h3 class="text-xl font-bold mb-3">Andauernde Relevanz</h3>
                    <p class="text-gray-700">In modernen, immer kompakteren Anlagen ist das Problem der Fremdfelder
                        sogar noch akuter. Pfuntners Methode bleibt ein unsch√§tzbares Werkzeug f√ºr Ingenieure zur
                        Erstabsch√§tzung und Plausibilit√§tspr√ºfung, auch im Zeitalter komplexer FEA-Simulationen.</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white mt-16">
        <div class="container mx-auto px-4 py-6 text-center text-sm">
            <p>&copy; 2025 Interaktive Aufbereitung basierend auf "The Accuracy of Current Transformers Adjacent to
                High-Current Busses" von R.A. Pfuntner, AIEE Transactions, 1951.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

            // --- DATA from Pfuntner's Paper ---
            const ctData = {
                '1': { R: 3, r: 1.5, W: 0.5, Ns: 183, A: 0.71, Rs: 0.139, burdens: { low: 0.166, high: 0.380 } },
                '2': { R: 3, r: 1.5, W: 1.5, Ns: 165, A: 2.12, Rs: 0.174, burdens: { low: 0.166, high: 0.380 } },
                '3': { R: 3, r: 2.5, W: 1.5, Ns: 209, A: 1.41, Rs: 0.157, burdens: { low: 0.166, high: 0.380 } }
            };

            const chartRawData = {
                '1': {
                    'low': {
                        '6': { currents: [1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000], rcf: [1.002, 1.004, 1.006, 1.009, 1.015, 1.025, 1.045, 1.11], pa: [0.5, 0.9, 1.4, 2.0, 3.0, 4.5, 7.0, 11.0] },
                        '12': { currents: [2000, 4000, 6000, 8000, 10000], rcf: [1.001, 1.002, 1.004, 1.007, 1.012], pa: [0.4, 0.8, 1.2, 1.8, 2.5] },
                        '24': { currents: [2000, 6000, 10000, 14000], rcf: [1.0, 1.001, 1.002, 1.004], pa: [0.3, 0.7, 1.1, 1.6] }
                    },
                    'high': {
                        '6': { currents: [1000, 2000, 3000, 4000, 5000, 6000], rcf: [1.004, 1.008, 1.015, 1.028, 1.06, 1.15], pa: [1.0, 2.0, 3.5, 5.5, 9.0, 15.0] },
                        '12': { currents: [2000, 4000, 6000, 8000, 9000], rcf: [1.002, 1.005, 1.009, 1.018, 1.028], pa: [0.8, 1.5, 2.5, 4.0, 5.5] },
                        '24': { currents: [2000, 6000, 10000, 12000], rcf: [1.001, 1.003, 1.006, 1.009], pa: [0.6, 1.2, 2.0, 2.6] }
                    }
                },
                '2': {
                    'low': {
                        '6': { currents: [2000, 6000, 10000, 14000, 18000], rcf: [1.0, 1.001, 1.002, 1.003, 1.005], pa: [0.2, 0.4, 0.6, 0.9, 1.3] },
                        '12': { currents: [5000, 10000, 20000, 30000], rcf: [1.0, 1.0, 1.001, 1.002], pa: [0.1, 0.2, 0.4, 0.6] },
                        '24': { currents: [10000, 20000, 30000, 40000], rcf: [1.0, 1.0, 1.0, 1.001], pa: [0.1, 0.2, 0.3, 0.4] }
                    },
                    'high': {
                        '6': { currents: [2000, 6000, 10000, 14000, 16000], rcf: [1.0, 1.001, 1.002, 1.004, 1.006], pa: [0.3, 0.6, 1.0, 1.5, 1.8] },
                        '12': { currents: [5000, 10000, 20000, 25000], rcf: [1.0, 1.001, 1.002, 1.003], pa: [0.2, 0.4, 0.7, 0.9] },
                        '24': { currents: [10000, 20000, 30000, 40000], rcf: [1.0, 1.0, 1.001, 1.002], pa: [0.2, 0.3, 0.5, 0.6] }
                    }
                },
                '3': {
                    'low': {
                        '6': { currents: [2000, 6000, 10000, 14000, 18000], rcf: [1.0, 1.001, 1.002, 1.004, 1.008], pa: [0.2, 0.5, 0.8, 1.2, 1.8] },
                        '12': { currents: [5000, 10000, 20000, 30000], rcf: [1.0, 1.0, 1.001, 1.002], pa: [0.1, 0.3, 0.5, 0.8] },
                        '24': { currents: [10000, 20000, 30000, 40000], rcf: [1.0, 1.0, 1.0, 1.001], pa: [0.1, 0.2, 0.4, 0.5] }
                    },
                    'high': {
                        '6': { currents: [2000, 6000, 10000, 12000, 14000], rcf: [1.0, 1.001, 1.003, 1.005, 1.008], pa: [0.3, 0.7, 1.2, 1.6, 2.1] },
                        '12': { currents: [5000, 10000, 15000, 20000], rcf: [1.0, 1.001, 1.002, 1.003], pa: [0.2, 0.5, 0.7, 1.0] },
                        '24': { currents: [10000, 20000, 30000, 40000], rcf: [1.0, 1.0, 1.001, 1.002], pa: [0.2, 0.4, 0.6, 0.7] }
                    }
                }
            };

            // --- Calculator Elements ---
            const calculatorInputs = {
                R: document.getElementById('R'),
                r_inner: document.getElementById('r_inner'),
                W: document.getElementById('W'),
                A: document.getElementById('A'),
                D_slider: document.getElementById('D_slider'),
                Zb: document.getElementById('Zb'),
                Ns: document.getElementById('Ns'),
            };
            const calculatorOutputs = {
                D_val: document.getElementById('D_val'),
                k_val: document.getElementById('k_val'),
                Ip_limit: document.getElementById('Ip_limit'),
                statusBox: document.getElementById('status-box'),
                fluxRing: document.getElementById('flux-ring-inner')
            };
            const ctButtons = {
                ct1: document.getElementById('btn-ct1'),
                ct2: document.getElementById('btn-ct2'),
                ct3: document.getElementById('btn-ct3'),
                custom: document.getElementById('btn-custom')
            };
            const customInputsDiv = document.getElementById('custom-inputs');

            let activeCt = '1';

            // --- Chart Elements ---
            const chartSelectors = {
                ct: document.getElementById('chart-ct'),
                burden: document.getElementById('chart-burden'),
                distance: document.getElementById('chart-distance')
            };
            let accuracyChart;

            // --- Functions ---

            function getKFactor(D_R, R_r_R, W_R) {
                // Simplified model based on Pfuntner's Figure 6.
                // This is an approximation for demonstration purposes.
                let k_base = 0;
                if (D_R <= 2) k_base = 7 + 15 * (1 - W_R / 0.5);
                else if (D_R <= 4) k_base = 8 + 12 * (1 - W_R / 0.5);
                else k_base = 9 + 15 * (1 - W_R / 0.5);

                let k = k_base * (1 + 0.5 * (0.5 - R_r_R));
                return Math.max(k, 1.0); // k is at least 1
            }

            function calculate() {
                const R = parseFloat(calculatorInputs.R.value);
                const r_inner = parseFloat(calculatorInputs.r_inner.value);
                const W = parseFloat(calculatorInputs.W.value);
                const A = parseFloat(calculatorInputs.A.value);
                const D = parseFloat(calculatorInputs.D_slider.value);
                const Zb = parseFloat(calculatorInputs.Zb.value);
                const Ns = parseFloat(calculatorInputs.Ns.value);

                if ([R, r_inner, W, A, D, Zb, Ns].some(isNaN)) {
                    calculatorOutputs.Ip_limit.textContent = 'Ung√ºltige Eingabe';
                    return;
                }

                calculatorOutputs.D_val.textContent = D.toFixed(1);

                const D_R = D / R;
                const R_r_R = (R - r_inner) / R;
                const W_R = W / R;

                const k = getKFactor(D_R, R_r_R, W_R);
                calculatorOutputs.k_val.textContent = k.toFixed(2);

                const C_50Hz = 1.60e-6; // Constant for 50Hz
                const saturationDensity = 0.14; // V/turn/in^2 for Mumetal

                // Simplified calculation from page 5/6
                const phiB_per_Ip = Zb / (Ns * Ns);
                const phi01_per_Ip = (C_50Hz * 0.6) * k * W * Math.log((D + R) / (D - R));

                const totalFlux_per_Ip = phiB_per_Ip + phi01_per_Ip;
                const totalDensity_per_Ip = totalFlux_per_Ip / A;

                const Ip_limit = saturationDensity / totalDensity_per_Ip;

                if (Ip_limit > 0 && isFinite(Ip_limit)) {
                    calculatorOutputs.Ip_limit.textContent = `${Math.round(Ip_limit).toLocaleString('de-DE')} A`;
                    if (Ip_limit < 5000) {
                        calculatorOutputs.statusBox.className = 'p-4 rounded-lg text-center font-bold text-xl mb-4 transition-colors bg-red-200 text-red-800';
                        calculatorOutputs.statusBox.textContent = 'KRITISCH';
                        calculatorOutputs.fluxRing.style.borderColor = `hsl(0, 80%, 60%)`;
                    } else if (Ip_limit < 10000) {
                        calculatorOutputs.statusBox.className = 'p-4 rounded-lg text-center font-bold text-xl mb-4 transition-colors bg-yellow-200 text-yellow-800';
                        calculatorOutputs.statusBox.textContent = 'WARNUNG';
                        calculatorOutputs.fluxRing.style.borderColor = `hsl(45, 80%, 60%)`;
                    } else {
                        calculatorOutputs.statusBox.className = 'p-4 rounded-lg text-center font-bold text-xl mb-4 transition-colors bg-green-200 text-green-800';
                        calculatorOutputs.statusBox.textContent = 'SICHER';
                        calculatorOutputs.fluxRing.style.borderColor = `hsl(100, 80%, 60%)`;
                    }
                } else {
                    calculatorOutputs.Ip_limit.textContent = 'N/A';
                    calculatorOutputs.statusBox.className = 'p-4 rounded-lg text-center font-bold text-xl mb-4 transition-colors bg-gray-200 text-gray-800';
                    calculatorOutputs.statusBox.textContent = 'STATUS';
                    calculatorOutputs.fluxRing.style.borderColor = 'lightgray';
                }
            }

            function updateCalculatorForm(ctId) {
                activeCt = ctId;
                Object.values(ctButtons).forEach(btn => btn.classList.remove('active', 'btn-primary'));
                if (ctButtons[ctId]) {
                    ctButtons[ctId].classList.add('active', 'btn-primary');
                } else {
                    ctButtons.custom.classList.add('active', 'btn-primary');
                }

                if (ctId === 'custom') {
                    customInputsDiv.classList.remove('hidden');
                    Object.values(calculatorInputs).forEach(input => {
                        if (input.id !== 'D_slider') input.disabled = false;
                    });
                } else {
                    customInputsDiv.classList.add('hidden');
                    const data = ctData[ctId];
                    calculatorInputs.R.value = data.R;
                    calculatorInputs.r_inner.value = data.r;
                    calculatorInputs.W.value = data.W;
                    calculatorInputs.A.value = data.A;
                    calculatorInputs.Ns.value = data.Ns;
                    calculatorInputs.Zb.value = (data.burdens.high + data.Rs).toFixed(3);

                    Object.values(calculatorInputs).forEach(input => {
                        if (input.id !== 'D_slider' && input.id !== 'Zb') input.disabled = true;
                        if (input.id === 'Zb') input.disabled = false;
                    });
                }
                calculate();
            }

            function setupChart() {
                const ctx = document.getElementById('accuracyChart').getContext('2d');
                accuracyChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: '√úbersetzungsfehler (RCF)',
                                data: [],
                                borderColor: 'rgb(75, 192, 192)',
                                backgroundColor: 'rgba(75, 192, 192, 0.5)',
                                yAxisID: 'y',
                                tension: 0.1
                            },
                            {
                                label: 'Phasenwinkel (PA ¬∞)',
                                data: [],
                                borderColor: 'rgb(255, 99, 132)',
                                backgroundColor: 'rgba(255, 99, 132, 0.5)',
                                yAxisID: 'y1',
                                tension: 0.1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Prim√§rstrom (A)'
                                }
                            },
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Ratio Correction Factor (RCF)'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Phasenwinkel (¬∞)'
                                },
                                grid: {
                                    drawOnChartArea: false,
                                },
                            }
                        }
                    }
                });
            }

            function updateChart() {
                const ct = chartSelectors.ct.value;
                const burden = chartSelectors.burden.value;
                const distance = chartSelectors.distance.value;

                const data = chartRawData[ct]?.[burden]?.[distance];

                if (data) {
                    accuracyChart.data.labels = data.currents;
                    accuracyChart.data.datasets[0].data = data.rcf;
                    accuracyChart.data.datasets[1].data = data.pa;
                    accuracyChart.update();
                }
            }

            // --- Event Listeners ---
            Object.values(calculatorInputs).forEach(input => {
                input.addEventListener('input', calculate);
            });

            ctButtons.ct1.addEventListener('click', () => updateCalculatorForm('1'));
            ctButtons.ct2.addEventListener('click', () => updateCalculatorForm('2'));
            ctButtons.ct3.addEventListener('click', () => updateCalculatorForm('3'));
            ctButtons.custom.addEventListener('click', () => updateCalculatorForm('custom'));

            Object.values(chartSelectors).forEach(selector => {
                selector.addEventListener('change', updateChart);
            });

            // Smooth scrolling for nav links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

            // Nav link active state on scroll
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');
            window.onscroll = () => {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= sectionTop - 80) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href').includes(current)) {
                        link.classList.add('active');
                    }
                });
            };

            // --- Initializations ---
            updateCalculatorForm('1');
            setupChart();
            updateChart();
        });
    </script>

</body>

</html>